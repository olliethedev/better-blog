---
title: Next.js App Router
description: SSR/SSG with server prefetch and client hydration
---

This renders all blog routes under `/posts/...` with server prefetch + client hydration. Provide separate data providers for server and client.

#### 1) `app/posts/[[...all]]/page.tsx` (server)

```tsx
import { createServerAdapter } from 'better-blog/server';
import type { BlogDataProvider } from 'better-blog';
import type { Metadata } from 'next';
import { getQueryClient } from '@/lib/get-query-client';

const serverBlogConfig: BlogDataProvider = {
  async getAllPosts(filter) { /* implement */ return []; },
  async getPostBySlug(slug) { /* implement */ return null; },
};

const queryClient = getQueryClient();
const adapter = createServerAdapter(serverBlogConfig, queryClient);

export const generateStaticParams = adapter.generateStaticParams;
export const generateMetadata: (ctx: { params: Promise<{ all: string[] }> }) => Promise<Metadata> = adapter.generateMetadata as any;

export default function Page({ params }: { params: { all?: string[] } }) {
  return (
    <adapter.Entry
      params={Promise.resolve({ all: params.all ?? [] })}
      queryClient={queryClient}
    />
  );
}
```

#### 2) `app/posts/layout.tsx` (server)

```tsx
import type { ReactNode } from 'react';
import { Provider } from '@/components/providers';

export default function BlogLayout({ children }: { children: ReactNode }) {
  return (
    <Provider>
      <header><nav><a href="/posts">All Posts</a></nav></header>
      <main>{children}</main>
      <footer />
    </Provider>
  );
}
```

#### 3) `components/providers.tsx` (client)

```tsx
'use client';
import type { ReactNode } from 'react';
import { QueryClientProvider } from '@tanstack/react-query';
import Link from 'next/link';
import Image from 'next/image';
import { BetterBlogContextProvider } from 'better-blog/client';
import type { ComponentsContextValue, BlogDataProvider } from 'better-blog';
import { getQueryClient } from '@/lib/get-query-client';

const components: ComponentsContextValue = {
  Link: ({ href, children, className }) => (<Link href={href} className={className}>{children}</Link>),
  Image: ({ src, alt, className, width, height }) => (
    <Image src={src} alt={alt} className={className} width={width ?? 800} height={height ?? 400} />
  ),
};

const clientBlogConfig: BlogDataProvider = {
  async getAllPosts(filter) { /* implement */ return []; },
  async getPostBySlug(slug) { /* implement */ return null; },
};

export function Provider({ children }: { children: ReactNode }) {
  const queryClient = getQueryClient();
  return (
    <QueryClientProvider client={queryClient}>
      <BetterBlogContextProvider clientConfig={clientBlogConfig} components={components}>
        {children}
      </BetterBlogContextProvider>
    </QueryClientProvider>
  );
}
```

Add the [Query Client helper](/core-concepts#tanstack-query-setup) to reuse a single client in the browser.

